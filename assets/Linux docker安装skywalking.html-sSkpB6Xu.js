import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as a,f as n}from"./app-yhW6njzi.js";const l={},e=n(`<h1 id="skywalking-es-docker" tabindex="-1"><a class="header-anchor" href="#skywalking-es-docker"><span>Skywalking + ES + Docker</span></a></h1><blockquote><p>搭建 elasticsearch集群 及 kibana</p><p>https://blog.csdn.net/qq_43692950/article/details/122834930</p></blockquote><p>Skywalking详细解读参考：<a href="https://www.cnblogs.com/jiagooushi/p/16381838.html" target="_blank" rel="noopener noreferrer">Skywalking应用实战 Agent探针、Rocketbot以及告警</a></p><p>https://www.cnblogs.com/jiagooushi/archive/2022/06/16/16381838.html</p><blockquote><p>Skywalking跟ES版本需要适配</p><p>比如目前我用的版本是：</p><p><strong>版本对应关系</strong></p><p>apache/skywalking-ui:8.6.0</p><p>apache/skywalking-oap-server:8.6.0</p><p>#agent:8.6.0不能用没有字体库，某些业务场景下会报错</p><p>apache/skywalking-java-agent:8.6.0</p><p><strong>方案一：</strong></p><p>#升级版本</p><p>apache/skywalking-java-agent:8.9.0-java8</p><p><strong>方案二：</strong></p><p>#自定义镜像，源码编译agent:8.6.0将orecleJDK打进去</p></blockquote><h1 id="skywalking-组件关系及部署" tabindex="-1"><a class="header-anchor" href="#skywalking-组件关系及部署"><span>skywalking 组件关系及部署</span></a></h1><h3 id="_1、skywalking由三个部分组成" tabindex="-1"><a class="header-anchor" href="#_1、skywalking由三个部分组成"><span>1、skywalking由三个部分组成</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">skywalking-collector:链路数据归集器，数据可以落地ElasticSearch/H2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">skywalking-ui:web可视化平台，用来展示落地的数据</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">skywalking-agent:探针，用来收集和发送数据到归集器</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、配置关系" tabindex="-1"><a class="header-anchor" href="#_2、配置关系"><span>2、配置关系</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">1,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> skywalking-oap</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 有两个端口暴露</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 11800</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ：grpc协议</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  用于agent上传数据</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">3,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 12800</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ：rset协议</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  用于与skywalking-ui通信，skywalking-ui配置SW_OAP_ADDRESS时</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 要注意填写12800端口</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="一、kubesphere创建oap" tabindex="-1"><a class="header-anchor" href="#一、kubesphere创建oap"><span>一、kubesphere创建oap</span></a></h3><p>创建无状态服务</p><h4 id="_1、填写镜像路径" tabindex="-1"><a class="header-anchor" href="#_1、填写镜像路径"><span>1、填写镜像路径</span></a></h4><h4 id="_2、使用默认端口" tabindex="-1"><a class="header-anchor" href="#_2、使用默认端口"><span>2、使用默认端口</span></a></h4><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090552.png" alt="image-20220826100411131" tabindex="0" loading="lazy"><figcaption>image-20220826100411131</figcaption></figure><h4 id="_3、填写环境变量-设置数据源" tabindex="-1"><a class="header-anchor" href="#_3、填写环境变量-设置数据源"><span>3、填写环境变量,设置数据源</span></a></h4><p>选择es数据源（不设置收集的数据源默认保存至h2数据库）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>env:</span></span>
<span class="line"><span>- name: JVM</span></span>
<span class="line"><span>value: &#39;-Xms256m -Xmx256m&#39;</span></span>
<span class="line"><span>- name: SW_STORAGE</span></span>
<span class="line"><span>value: elasticsearch7</span></span>
<span class="line"><span>- name: SW_STORAGE_ES_CLUSTER_NODES</span></span>
<span class="line"><span>value: &#39;xxx.xxx.xxx:9200&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090558.png" alt="image-20220902173454914" tabindex="0" loading="lazy"><figcaption>image-20220902173454914</figcaption></figure><h3 id="二、kubesphere创建ui" tabindex="-1"><a class="header-anchor" href="#二、kubesphere创建ui"><span>二、kubesphere创建UI</span></a></h3><h4 id="_1、填写镜像路径-1" tabindex="-1"><a class="header-anchor" href="#_1、填写镜像路径-1"><span>1、填写镜像路径</span></a></h4><h4 id="_2、使用默认端口-1" tabindex="-1"><a class="header-anchor" href="#_2、使用默认端口-1"><span>2、使用默认端口</span></a></h4><h4 id="_3、填写环境变量-连接oap" tabindex="-1"><a class="header-anchor" href="#_3、填写环境变量-连接oap"><span>3、填写环境变量,连接oap</span></a></h4><p>oap的dns地址</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//oap连接服务端口：12800</span></span>
<span class="line"><span>SW_OAP_ADDRESS:skywalking-oap-server.test5:12800</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090606.png" alt="image-20220826154758399" tabindex="0" loading="lazy"><figcaption>image-20220826154758399</figcaption></figure><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090613.png" alt="image-20220826140418379" tabindex="0" loading="lazy"><figcaption>image-20220826140418379</figcaption></figure><h4 id="_4、访问页面" tabindex="-1"><a class="header-anchor" href="#_4、访问页面"><span>4、访问页面：</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ip+端口8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>skywalking懒加载，初次访问时，看不到监控数据，需要访问服务接口后，skywalking才会加载数据</p><h3 id="三、项目配置" tabindex="-1"><a class="header-anchor" href="#三、项目配置"><span>三、项目配置</span></a></h3><p>dockfile文件基础镜像使用skywalking-jdk</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#设置镜像基础，jdk8</span></span>
<span class="line"><span>#FROM java:8</span></span>
<span class="line"><span>FROM xxx.xxx.xxx.xxx:8080/common/skywalking-java-agent:8.6.0-jdk8-me</span></span>
<span class="line"><span>#维护人员信息</span></span>
<span class="line"><span>MAINTAINER hetao</span></span>
<span class="line"><span>#设置镜像对外暴露端口</span></span>
<span class="line"><span>EXPOSE 10013</span></span>
<span class="line"><span>ENV TZ=PRC</span></span>
<span class="line"><span>RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone</span></span>
<span class="line"><span>#将当前 target 目录下的 jar 放置在根目录下，命名为 app.jar，推荐使用绝对路径。</span></span>
<span class="line"><span>ADD target/devops-sign.jar /devops-sign.jar</span></span>
<span class="line"><span>#执行启动命令</span></span>
<span class="line"><span>ENTRYPOINT java \${JVM:=-Xms2048m -Xmx2048m} -Djava.security.egd=file:/dev/./urandom -jar /devops-sign.jar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>项目yml文件中配置oap环境变量-连接skywalking</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 配置oap连接地址</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SW_AGENT_COLLECTOR_BACKEND_SERVICES</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;skywalking-oap-server.test5:11800&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 配置服务名称</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SW_AGENT_NAME</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">value:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> devops-cloud-gateway</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090621.png" alt="image-20220826163627042" tabindex="0" loading="lazy"><figcaption>image-20220826163627042</figcaption></figure><h3 id="四、自定义镜像" tabindex="-1"><a class="header-anchor" href="#四、自定义镜像"><span>四、自定义镜像</span></a></h3><p>在项目接入中遇到问题二，抛弃官方提供的镜像，选择自定义skywalking-agent镜像</p><h4 id="_1、下载对应版本skywalking-agent" tabindex="-1"><a class="header-anchor" href="#_1、下载对应版本skywalking-agent"><span><strong>1、下载对应版本skywalking-agent</strong></span></a></h4><h4 id="_2-、编写dockerfile" tabindex="-1"><a class="header-anchor" href="#_2-、编写dockerfile"><span><strong>2.、编写Dockerfile</strong></span></a></h4><p><strong>方法一：通过源码编译agent</strong></p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">//Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#OracleJDK1.8基础镜像</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> java:8</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#将编译构建得到的jar文件复制到镜像空间中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> agent/ /skywalking/agent/</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#执行工作目录</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#skywalking-agent环境变量,指定jar路径</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> JAVA_TOOL_OPTIONS=-javaagent:/skywalking/agent/skywalking-agent.jar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>方法二：通过基础镜像base引用agent目录</strong>(项目中用workflow有点问题)</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#定义skywalking-base基础镜像版本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ARG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> version=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;8.6.0&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#定义jdk基础镜像版本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ARG</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> BASE_IMAGE=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;java:8&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#skywalking-base基础镜像引用</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> apache/skywalking-base:\${version}-es7 </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">AS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> build</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#jdk基础镜像引用</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $BASE_IMAGE</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#作者</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LABEL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> maintainer=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ldf&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#skywalking-agent环境变量,指定jar路径</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> JAVA_TOOL_OPTIONS=-javaagent:/skywalking/agent/skywalking-agent.jar</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#指定工作目录</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /skywalking</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#添加文件,添加引用镜像中的agent目录到自定义镜像工作空间中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> --from=build /skywalking/agent /skywalking/agent</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、构建自定义镜像" tabindex="-1"><a class="header-anchor" href="#_3、构建自定义镜像"><span><strong>3、构建自定义镜像</strong></span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#打包镜像文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> skywalking-java-agent:8.6.0-java8-me</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Dockerfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>启动项目后出现下图中找到agent.config配置文件即接入成功。</strong></p><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090629.png" alt="image-20220902145433470" tabindex="0" loading="lazy"><figcaption>image-20220902145433470</figcaption></figure><h3 id="五、问题说明" tabindex="-1"><a class="header-anchor" href="#五、问题说明"><span>五、问题说明：</span></a></h3><h5 id="问题一" tabindex="-1"><a class="header-anchor" href="#问题一"><span><strong>问题一</strong></span></a></h5><blockquote><p><a href="https://so.csdn.net/so/search?q=docker&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">docker</a> 部署skywalking时，一直报错：<code>no provider found for module storage</code></p><h6 id="原因分析" tabindex="-1"><a class="header-anchor" href="#原因分析"><span><strong>原因分析：</strong></span></a></h6><ol><li>skywalking 8.8之前不能自动感知存储源是什么，需要手动指定是es6还是7；</li><li>8.8之后可以自动感知存储源的版本，不需要手动指定es6还是7，直接写es即可；</li></ol><p><strong>解决方案：</strong></p><p>将环境变量指定数据源：SW_STORAGE=elasticsearch7<code>改为</code>SW_STORAGE=elasticsearch\`</p></blockquote><h5 id="问题二" tabindex="-1"><a class="header-anchor" href="#问题二"><span><strong>问题二</strong></span></a></h5><blockquote><h5 id="jdk字体类初始化异常问题-java-lang-noclassdeffounderror-could-not-initialize-class-sun-font-sunfontmanager" tabindex="-1"><a class="header-anchor" href="#jdk字体类初始化异常问题-java-lang-noclassdeffounderror-could-not-initialize-class-sun-font-sunfontmanager"><span>JDK字体类初始化异常问题：java.lang.NoClassDefFoundError: Could not initialize class sun.font.SunFontManager</span></a></h5><p><strong>原因分析：</strong></p><p>skywalking官方提供的agent镜像中jdk采用的是OpenJDK，而OpenJDK在1.7之后不包含字体库，在poi导出业务中存在报这种错误</p><p>OpenJDK比OracleJDK简化了一些功能，openjdk不包含字体库</p><p><strong>解决方案：</strong></p><p>方法1、有网的环境下把OpenJDK打包成包含fontconfig和字体 ttf-dejavu的镜像</p><p>方法2、升级jdk版本，jdk “1.8.0_332” 请升级成 jdk “1.8.0_333” 或更高的版本</p><p>以上方法由互联网提供，以下是我自己的实践的方案</p><p>1、通过源码编译agent，将OracleJDK打入agent镜像中</p><p>或者</p><p>2、通过基础镜像base引用agent目录，将OracleJDK打入agent镜像中</p></blockquote><h5 id="问题三" tabindex="-1"><a class="header-anchor" href="#问题三"><span><strong>问题三</strong></span></a></h5><blockquote><p>**超出了GC开销限制：**java.lang.OutOfMemoryError: GC overhead limit exceeded｜ java.lang.OutOfMemoryError: Java heap space</p><p><strong>原因分析：</strong></p><p>这个是JDK6新添的错误类型。是发生在GC占用大量时间为释放很小空间的时候发生的，是一种保护机制。一般是因为堆太小，导致异常的原因：没有足够的<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">内存</a>。</p><p>Sun 官方对此的定义：超过98%的时间用来做GC并且回收了不到2%的堆内存时会抛出此异常。</p><p><strong>解决方案</strong>：</p><p>方法1，查看项目中是否有大量的死循环或有使用大内存的代码，优化代码。</p><p>方法2，JVM给出这样一个参数：-XX:-UseGCOverheadLimit 禁用这个检查，其实这个参数解决不了内存问题，只是把错误的信息延后，替换成 java.lang.OutOfMemoryError: Java heap space。</p><p>方法3，增大堆内存 set JAVA_OPTS=-server -Xms512m -Xmx1024m -XX:MaxNewSize=1024m -XX:MaxPermSize=1024m</p><p>我采用 增大堆内存的方式将原来的内存增加到了512</p><p>env:</p><p>name: JVM value: &#39;-Xms512m -Xmx512m&#39;</p></blockquote><h5 id="问题四" tabindex="-1"><a class="header-anchor" href="#问题四"><span><strong>问题四</strong></span></a></h5><blockquote><p>1、agent的plugins目录是已启用的插件，optional-plugins目录中是可选的插件。</p><p>plugins中默认没有springcloud getway插件，不支持监控springcloud gateway网关服务。</p><p>如果当前要部署的服务是springcloud getway网关服务，需要把optional-plugins中的apm-spring-cloud-gateway-2.1.x-plugin-8.2.0.jar拷贝到plugins中。</p></blockquote><h5 id="kubesphere安装-es配置文件" tabindex="-1"><a class="header-anchor" href="#kubesphere安装-es配置文件"><span><strong>kubesphere安装|es配置文件</strong></span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> #es配置文件</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> #集群名称配置</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  cluster.name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my-es</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #节点角色配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #node.roles: [ data, master ]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #网络配置</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  network.host:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #集群节点配置</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  discovery.type:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> single-node</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #discovery.seed_hosts: [ &quot;app-es-v1-0.app-es.app.svc.cluster.local:9300&quot; ]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #集群初始化节点</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #cluster.initial_master_nodes: [ &quot;app-es-v1-0&quot;]</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #绑定客户端访问端口</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  http.port:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9200</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #绑定集群间通信端口</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  transport.port:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9300</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #安全访问</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  xpack.security.enabled:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  xpack.security.transport.ssl.enabled:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #认证</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  http.cors.allow-origin:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;*&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  http.cors.enabled:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  http.max_content_length:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 200mb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="skywalking操作说明" tabindex="-1"><a class="header-anchor" href="#skywalking操作说明"><span>Skywalking操作说明</span></a></h2><p>SkyWalking 逻辑上分为四部分: 探针, 平台后端, 存储和用户界面。</p><blockquote><p>探针skywalking-agent收集数据上报给平台后端</p><p>平台后端skywalking-oap存储相关数据</p><p>用户界面skywalking-ui连接平台后端查询数据展示</p></blockquote><p><strong>操作说明：</strong></p><h2 id="_1、访问skywalking-ui面板" tabindex="-1"><a class="header-anchor" href="#_1、访问skywalking-ui面板"><span>1、访问skywalking-ui面板</span></a></h2><p>skywalking属于懒加载，第一次访问不会有数据视图，访问接口后产生相应的数据视图</p><p>目前启动了三个服务，可选择相应服务查看对应系统图</p><p><strong>仪表盘：查看服务系统性能</strong></p><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090644.png" alt="image-20220804123724252" tabindex="0" loading="lazy"><figcaption>image-20220804123724252</figcaption></figure><p><strong>拓扑图</strong>：系统关联关系结构</p><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090650.png" alt="image-20220804124051725" tabindex="0" loading="lazy"><figcaption>image-20220804124051725</figcaption></figure><p><strong>链路追踪：接口生命周期跟踪</strong></p><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090657.png" alt="image-20220804124349974" tabindex="0" loading="lazy"><figcaption>image-20220804124349974</figcaption></figure><h2 id="_2、访问演示接口" tabindex="-1"><a class="header-anchor" href="#_2、访问演示接口"><span>2、访问演示接口</span></a></h2><p>POST 192.168.x.x:31368/system/sysLogin { &quot;userName&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;ZZ2022!!&quot;, &quot;date&quot;: 1651146995000 }</p><p>GET 192.168.x.x:31368/system/user/listPage</p><p>访问后等一小会待数据加载完毕，视图出现，</p><p>按时间范围查询接口</p><p>接入skywalking</p><p>1、下载包</p><p>2、编辑配置文件设置存储方式</p><p>3、运行访问ui控制台</p><p>4、导入jar到项目中（本地可直接引用下载包中的jar）</p><figure><img src="http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090703.png" alt="image-20220804124637278" tabindex="0" loading="lazy"><figcaption>image-20220804124637278</figcaption></figure><h2 id="日志接入" tabindex="-1"><a class="header-anchor" href="#日志接入"><span>日志接入</span></a></h2><p>导入依赖</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;!-- skywalking--&gt;</span></span>
<span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.apache.skywalking&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;apm-toolkit-logback-1.x&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;8.12.0&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span>
<span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.apache.skywalking&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;apm-toolkit-logback-1.x&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;8.12.0&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建日志文件 logback.xml</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ?&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">jmxConfigurator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!--    日志打印格式--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;log_pattern&quot;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">              value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;%d{yyyy-MM-dd HH:mm:ss.SSS Z} [%tid] [%thread] %-5level %logger{36}:%line - %msg%n&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!--    控制台日志--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;STDOUT&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">encoder</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;\${log_pattern}&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">encoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!--    文件日志--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;FILE&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">rollingPolicy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fileNamePattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;./logs/application/server.%d{yyyy-MM-dd}.%i.log.zip&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fileNamePattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">maxFileSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;100MB&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">maxFileSize</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">maxHistory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;15&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">maxHistory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">totalSizeCap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;5GB&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">totalSizeCap</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">rollingPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">encoder</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;\${log_pattern}&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">encoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- skywalking grpc 日志收集 8.4.0版本开始支持 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;grpc-log&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">encoder</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%tid] [%thread] %-5level %logger{36} -%msg%n&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">encoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logger</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;org.springframework&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> additivity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;false&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">level</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;info&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;STDOUT&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;FILE&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;grpc-log&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logger</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> level</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;INFO&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;STDOUT&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">appender-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;FILE&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">configuration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动项目可看到[TID:xxxxx]即接入成功</p><p>访问控制台日中管理中可看到</p>`,90),t=[e];function p(h,k){return a(),s("div",null,t)}const g=i(l,[["render",p],["__file","Linux docker安装skywalking.html.vue"]]),c=JSON.parse('{"path":"/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Linux%20docker%E5%AE%89%E8%A3%85skywalking.html","title":"Linux docker安装skywalking","lang":"zh-CN","frontmatter":{"title":"Linux docker安装skywalking","categories":["Docker"],"tags":["skywalking"],"order":4,"description":"Skywalking + ES + Docker 搭建 elasticsearch集群 及 kibana https://blog.csdn.net/qq_43692950/article/details/122834930 Skywalking详细解读参考：Skywalking应用实战 Agent探针、Rocketbot以及告警 https://ww...","head":[["meta",{"property":"og:url","content":"http://blog.lindaifeng.vip/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Linux%20docker%E5%AE%89%E8%A3%85skywalking.html"}],["meta",{"property":"og:site_name","content":"文档演示"}],["meta",{"property":"og:title","content":"Linux docker安装skywalking"}],["meta",{"property":"og:description","content":"Skywalking + ES + Docker 搭建 elasticsearch集群 及 kibana https://blog.csdn.net/qq_43692950/article/details/122834930 Skywalking详细解读参考：Skywalking应用实战 Agent探针、Rocketbot以及告警 https://ww..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090552.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-11T03:57:59.000Z"}],["meta",{"property":"article:author","content":"清峰"}],["meta",{"property":"article:tag","content":"skywalking"}],["meta",{"property":"article:modified_time","content":"2024-09-11T03:57:59.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux docker安装skywalking\\",\\"image\\":[\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090552.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090558.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090606.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090613.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090621.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090629.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090644.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090650.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090657.png\\",\\"http://img.lindaifeng.vip/typora-picgo-tuchaung/20221107090703.png\\"],\\"dateModified\\":\\"2024-09-11T03:57:59.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"清峰\\",\\"url\\":\\"http://blog.lindaifeng.vip/\\"}]}"]]},"headers":[{"level":3,"title":"1、skywalking由三个部分组成","slug":"_1、skywalking由三个部分组成","link":"#_1、skywalking由三个部分组成","children":[]},{"level":3,"title":"2、配置关系","slug":"_2、配置关系","link":"#_2、配置关系","children":[]},{"level":3,"title":"一、kubesphere创建oap","slug":"一、kubesphere创建oap","link":"#一、kubesphere创建oap","children":[]},{"level":3,"title":"二、kubesphere创建UI","slug":"二、kubesphere创建ui","link":"#二、kubesphere创建ui","children":[]},{"level":3,"title":"三、项目配置","slug":"三、项目配置","link":"#三、项目配置","children":[]},{"level":3,"title":"四、自定义镜像","slug":"四、自定义镜像","link":"#四、自定义镜像","children":[]},{"level":3,"title":"五、问题说明：","slug":"五、问题说明","link":"#五、问题说明","children":[]},{"level":2,"title":"Skywalking操作说明","slug":"skywalking操作说明","link":"#skywalking操作说明","children":[]},{"level":2,"title":"1、访问skywalking-ui面板","slug":"_1、访问skywalking-ui面板","link":"#_1、访问skywalking-ui面板","children":[]},{"level":2,"title":"2、访问演示接口","slug":"_2、访问演示接口","link":"#_2、访问演示接口","children":[]},{"level":2,"title":"日志接入","slug":"日志接入","link":"#日志接入","children":[]}],"git":{"createdTime":1726027079000,"updatedTime":1726027079000,"contributors":[{"name":"ldf","email":"1305366530@qq.com","commits":1}]},"readingTime":{"minutes":7.42,"words":2226},"filePathRelative":"deploy/Linux部署文档/软件安装/Linux docker安装skywalking.md","localizedDate":"2024年9月11日","autoDesc":true,"excerpt":"\\n<blockquote>\\n<p>搭建 elasticsearch集群 及 kibana</p>\\n<p>https://blog.csdn.net/qq_43692950/article/details/122834930</p>\\n</blockquote>\\n<p>Skywalking详细解读参考：<a href=\\"https://www.cnblogs.com/jiagooushi/p/16381838.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Skywalking应用实战 Agent探针、Rocketbot以及告警</a></p>\\n<p>https://www.cnblogs.com/jiagooushi/archive/2022/06/16/16381838.html</p>"}');export{g as comp,c as data};
