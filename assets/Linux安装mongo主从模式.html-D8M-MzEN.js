import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,o as i,f as a}from"./app-Ceiv-MAq.js";const e={},l=a(`<h1 id="linux-mongo集群模式之主从-副本集" tabindex="-1"><a class="header-anchor" href="#linux-mongo集群模式之主从-副本集"><span>Linux-Mongo集群模式之主从+副本集</span></a></h1><h2 id="一、知识沉淀" tabindex="-1"><a class="header-anchor" href="#一、知识沉淀"><span>一、知识沉淀：</span></a></h2><p><strong>Mongodb的replication主要有两种：主从和副本集（replica set）。现在mongodb官方建议用副本集替代主从复制。</strong></p><p><strong>什么是oplog：</strong></p><p>MongoDB 的Replication是通过一个日志来存储写操作的，这个日志就叫做oplog。 在默认情况下,oplog分配的是5%的空闲磁盘空间。通常而言,这是一种合理的设置。可以通过mongod --oplogSize来改变oplog的日志大小。</p><h4 id="主从复制" tabindex="-1"><a class="header-anchor" href="#主从复制"><span>主从复制：</span></a></h4><p>主从的原理和mysql类似，主节点记录在其上的所有操作oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。  主服务器数据库的每次操作都会记录在其二进制文件mysql-bin.xxx（该文件可以在mysql目录下的data目录中看到）中，从服务器的I/O线程使用专用账号登录到主服务器中读取该二进制文件，并将文件内容写入到自己本地的中继日志relay-log文件中，然后从服务器的SQL线程会根据中继日志中的内容执行SQL语句</p><figure><img src="https://gitee.com/lindaifeng/my-images/raw/master/img/7236980-ec85513460bb5cd6.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>MySQL主从同步的作用</p><p>1、可以作为备份机制，相当于热备份 2、可以用来做读写分离，均衡数据库负载</p><h4 id="副本集" tabindex="-1"><a class="header-anchor" href="#副本集"><span><strong>副本集：</strong></span></a></h4><figure><img src="https://gitee.com/lindaifeng/my-images/raw/master/img/replication.png" alt="MongoDB复制结构图" tabindex="0" loading="lazy"><figcaption>MongoDB复制结构图</figcaption></figure><h2 id="二、实战操作" tabindex="-1"><a class="header-anchor" href="#二、实战操作"><span>二、实战操作：</span></a></h2><h3 id="_1、mongo主从模式" tabindex="-1"><a class="header-anchor" href="#_1、mongo主从模式"><span>1、Mongo主从模式</span></a></h3><p>主从模式是MongoDB最早的部署架构。从节点备份数据，在主节点挂了后，可以让从节点接替主节点；也可以做到读写分离，减轻主库压力。</p><p>主节点：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mongod --dbpath=E:\\mongodb\\3.2.9\\mongodb\\db --logpath=E:\\mongodb\\3.2.9\\mongodb\\log\\log.txt --logappend --port=27017 --master</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>从节点</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mongod --dbpath=E:\\mongodb\\3.2.9\\slaveA\\db --logpath=E:\\mongodb\\3.2.9\\slaveA\\log\\log_slaveA.txt --logappend --port=27018 --slave --source=127.0.0.1:27017</span></span>
<span class="line"><span></span></span>
<span class="line"><span>或者，再主节点启动后，手动添加从节点</span></span>
<span class="line"><span>use local; -- local库的sources集合</span></span>
<span class="line"><span>db.sources.insert({&quot;host&quot;:&quot;127.0.0.1:27017&quot;}); -- 在子节点，指定主节点</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是，主从有它很大的局限性，比如:主节点挂了不能自动切换连接，需要手动切换，这时候怎么办呢？</p><h3 id="_2、mongo副本集" tabindex="-1"><a class="header-anchor" href="#_2、mongo副本集"><span>2、Mongo副本集</span></a></h3><p>复制集：由多个数据节点和选举节点组成，相连的数据节点只有一个是主节点，主节点负责接收写的操作，从节点是通过复制主节点来实现数据的同步。简单来说就是：从节点是通过数据的冗余来提高数据的可靠性。</p><p>从节点通过主节点的oplog文件，异步复制主节点的数据。</p><p>复制集基本角色：</p><p>1、标准节点：参与主节点primary的选举，自身宕机让出primary，复制读写操作。</p><p>2、从节点：从节点second不参与选举，只能被设置为被动节点。</p><p>3、仲裁节点：只参与投票，不负责存放数据。确保标准节点投票数不相同。</p><p><strong>mongo无认证的情况：</strong></p><p>配置文件如下【配置路径时需要确保 路径存在】</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>logpath=/var/lib/mongo/mongodb.log</span></span>
<span class="line"><span></span></span>
<span class="line"><span>logappend=true</span></span>
<span class="line"><span></span></span>
<span class="line"><span>dbpath=/var/lib/mongo/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>port = 27017</span></span>
<span class="line"><span></span></span>
<span class="line"><span>journal=true</span></span>
<span class="line"><span></span></span>
<span class="line"><span>quiet=true</span></span>
<span class="line"><span></span></span>
<span class="line"><span>fork=true</span></span>
<span class="line"><span></span></span>
<span class="line"><span>bind_ip=0.0.0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 集群配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>replSet=replSet</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>确保两边的防火墙关闭成功</p><p>复制集配置</p><p>将配置文件都修修改完之后</p><p>其中 replSet 是副本集名称，和conf文件中要保持一致</p><p>在mongod 控制台内输入</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rs.conf();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>提示找不到相关配置</p><p>##第一步：设置副本集内容</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>config = {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>_id: &#39;replSet&#39;, </span></span>
<span class="line"><span></span></span>
<span class="line"><span>members: [</span></span>
<span class="line"><span></span></span>
<span class="line"><span>{_id: 0, host: &#39;192.168.179.3:27017&#39;,priority:1},</span></span>
<span class="line"><span></span></span>
<span class="line"><span>{_id: 1, host: &#39;192.168.179.4:27017&#39;,priority:2},</span></span>
<span class="line"><span></span></span>
<span class="line"><span>{_id: 2, host: &#39;192.168.179.5:27017&#39;,priority:3}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>##第一步：初始化副本集</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rs.initiate(config)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>##第三步：查看副本集状态，找到private节点的IP</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rs.status()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>各个节点需要执行</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rs.secondaryOk()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>主节点启动监听</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>db.enableFreeMonitoring()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>mongo有认证的情况</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1、yml配置文件启动 </span></span>
<span class="line"><span>processManagement:</span></span>
<span class="line"><span>   fork: true</span></span>
<span class="line"><span>net:</span></span>
<span class="line"><span>   bindIp: 0.0.0.0</span></span>
<span class="line"><span>   port: 27017</span></span>
<span class="line"><span>storage:</span></span>
<span class="line"><span>   dbPath: /usr/local/mongodb/data/db</span></span>
<span class="line"><span>systemLog:</span></span>
<span class="line"><span>   destination: file</span></span>
<span class="line"><span>   path: /usr/local/mongodb/logs/mongodb.log</span></span>
<span class="line"><span>   logAppend: true</span></span>
<span class="line"><span>storage:</span></span>
<span class="line"><span>   journal:</span></span>
<span class="line"><span>      enabled: true</span></span>
<span class="line"><span># 改动</span></span>
<span class="line"><span>security:</span></span>
<span class="line"><span>  # 开启认证</span></span>
<span class="line"><span>  authorization: enabled</span></span>
<span class="line"><span>  # 认证文件的路径</span></span>
<span class="line"><span>  keyFile: &quot;/usr/local/mongodb/mongodb-keyfile&quot;</span></span>
<span class="line"><span>  clusterAuthMode: keyFile</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 改动</span></span>
<span class="line"><span>replication:</span></span>
<span class="line"><span>  oplogSizeMB: 10240</span></span>
<span class="line"><span>  # 副本集名称</span></span>
<span class="line"><span>  replSetName: replSet</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置文件启动：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>./bin/mongod --config mongodb.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>生成 keyFile(认证文件)及配置-上传到到每个服务器上</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">openssl</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> rand</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">base64</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 756</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> /</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">keyfile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>修改读写权限为 600 mongodb-keyfile</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 600</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> /</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">mongo</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">mongodb</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">keyfile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>进入mongo输入：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rs.conf();</span></span>
<span class="line"><span>查看配置信息，无任何配置信息</span></span>
<span class="line"><span>2021-09-11T17:32:30.840+0800 E QUERY    [thread1] Error: Could not retrieve replica set config: {</span></span>
<span class="line"><span>	&quot;info&quot; : &quot;run rs.initiate(...) if not yet done for the set&quot;,</span></span>
<span class="line"><span>	&quot;ok&quot; : 0,</span></span>
<span class="line"><span>	&quot;errmsg&quot; : &quot;no replset config has been received&quot;,</span></span>
<span class="line"><span>	&quot;code&quot; : 94,</span></span>
<span class="line"><span>	&quot;codeName&quot; : &quot;NotYetInitialized&quot;</span></span>
<span class="line"><span>} :</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一步：设置副本集内容</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>config = {</span></span>
<span class="line"><span>_id: &#39;replSet&#39;, </span></span>
<span class="line"><span>members: [</span></span>
<span class="line"><span>{_id: 0, host: &#39;主机ip:端口&#39;,priority:1}, //权重</span></span>
<span class="line"><span>{_id: 1, host: &#39;主机ip:27017&#39;,priority:2}, //权重（salve）</span></span>
<span class="line"><span>{_id: 2, host: &#39;主机ip:27017&#39;,priority:3} //权重高（master）</span></span>
<span class="line"><span>]</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>config = {</span></span>
<span class="line"><span>_id: &#39;replSet&#39;, </span></span>
<span class="line"><span>members: [</span></span>
<span class="line"><span>{_id: 0, host: &#39;192.168.179.3:27017&#39;,priority:1},</span></span>
<span class="line"><span>{_id: 1, host: &#39;192.168.179.4:27017&#39;,priority:2},</span></span>
<span class="line"><span>{_id: 2, host: &#39;192.168.179.5:27017&#39;,priority:3}</span></span>
<span class="line"><span>]</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>##第一步：初始化副本集</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rs.initiate(config) </span></span>
<span class="line"><span></span></span>
<span class="line"><span>返回{ &quot;ok&quot; : 1 }成功</span></span>
<span class="line"><span></span></span>
<span class="line"><span>返回错误信息</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	&quot;operationTime&quot; : Timestamp(1631352818, 2),</span></span>
<span class="line"><span>	&quot;ok&quot; : 0,</span></span>
<span class="line"><span>	&quot;errmsg&quot; : &quot;there are no users authenticated&quot;,</span></span>
<span class="line"><span>	&quot;code&quot; : 13,</span></span>
<span class="line"><span>	&quot;codeName&quot; : &quot;Unauthorized&quot;,</span></span>
<span class="line"><span>	&quot;$clusterTime&quot; : {</span></span>
<span class="line"><span>		&quot;clusterTime&quot; : Timestamp(1631352818, 2),</span></span>
<span class="line"><span>		&quot;signature&quot; : {</span></span>
<span class="line"><span>			&quot;hash&quot; : BinData(0,&quot;7qIwiTKM1e6QGQ5FpA23DSjUYTA=&quot;),</span></span>
<span class="line"><span>			&quot;keyId&quot; : NumberLong(&quot;7006606872698421250&quot;)</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>则需要认证</span></span>
<span class="line"><span>use admin;</span></span>
<span class="line"><span>db.auth(&#39;root&#39;,&#39;123456&#39;);</span></span>
<span class="line"><span>返回1认证成功</span></span>
<span class="line"><span></span></span>
<span class="line"><span>在执行配置命令</span></span>
<span class="line"><span>rs.initiate(config)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>##第三步：查看副本集状态，找到private节点的IP</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rs.status()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://gitee.com/lindaifeng/my-images/raw/master/img/image-20210911174818855.png" alt="image-20210911174818855" tabindex="0" loading="lazy"><figcaption>image-20210911174818855</figcaption></figure><p>这样配相当于主从，权重高的为主节点，权重低的为从节点。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//查看副本集主节点</span></span>
<span class="line"><span>db.isMaster();</span></span>
<span class="line"><span>//查看节点状态</span></span>
<span class="line"><span>rs.status()</span></span>
<span class="line"><span>//添加一个服务器为仲裁节点</span></span>
<span class="line"><span>rs.addArb(ip:端口);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//移除所有节点</span></span>
<span class="line"><span>db.shutdownServer()</span></span>
<span class="line"><span>//移除单个节点</span></span>
<span class="line"><span>rs.remove(&#39;192.168.56.105:27017&#39;)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主节点能操作，从节点同步数据，但从节点不能操作。</p><p>至此，mongo的集群搭建完毕。</p>`,70),p=[l];function d(t,r){return i(),n("div",null,p)}const h=s(e,[["render",d],["__file","Linux安装mongo主从模式.html.vue"]]),g=JSON.parse('{"path":"/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Linux%E5%AE%89%E8%A3%85mongo%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F.html","title":"Linux安装mongo主从模式","lang":"zh-CN","frontmatter":{"title":"Linux安装mongo主从模式","categories":["Linux"],"tags":["mongodb"],"order":8,"description":"Linux-Mongo集群模式之主从+副本集 一、知识沉淀： Mongodb的replication主要有两种：主从和副本集（replica set）。现在mongodb官方建议用副本集替代主从复制。 什么是oplog： MongoDB 的Replication是通过一个日志来存储写操作的，这个日志就叫做oplog。 在默认情况下,oplog分配的是5...","head":[["meta",{"property":"og:url","content":"http://blog.lindaifeng.vip/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Linux%E5%AE%89%E8%A3%85mongo%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F.html"}],["meta",{"property":"og:site_name","content":"文档演示"}],["meta",{"property":"og:title","content":"Linux安装mongo主从模式"}],["meta",{"property":"og:description","content":"Linux-Mongo集群模式之主从+副本集 一、知识沉淀： Mongodb的replication主要有两种：主从和副本集（replica set）。现在mongodb官方建议用副本集替代主从复制。 什么是oplog： MongoDB 的Replication是通过一个日志来存储写操作的，这个日志就叫做oplog。 在默认情况下,oplog分配的是5..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://gitee.com/lindaifeng/my-images/raw/master/img/7236980-ec85513460bb5cd6.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-11T03:57:59.000Z"}],["meta",{"property":"article:author","content":"清峰"}],["meta",{"property":"article:tag","content":"mongodb"}],["meta",{"property":"article:modified_time","content":"2024-09-11T03:57:59.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux安装mongo主从模式\\",\\"image\\":[\\"https://gitee.com/lindaifeng/my-images/raw/master/img/7236980-ec85513460bb5cd6.jpg\\",\\"https://gitee.com/lindaifeng/my-images/raw/master/img/replication.png\\",\\"https://gitee.com/lindaifeng/my-images/raw/master/img/image-20210911174818855.png\\"],\\"dateModified\\":\\"2024-09-11T03:57:59.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"清峰\\",\\"url\\":\\"http://blog.lindaifeng.vip/\\"}]}"]]},"headers":[{"level":2,"title":"一、知识沉淀：","slug":"一、知识沉淀","link":"#一、知识沉淀","children":[]},{"level":2,"title":"二、实战操作：","slug":"二、实战操作","link":"#二、实战操作","children":[{"level":3,"title":"1、Mongo主从模式","slug":"_1、mongo主从模式","link":"#_1、mongo主从模式","children":[]},{"level":3,"title":"2、Mongo副本集","slug":"_2、mongo副本集","link":"#_2、mongo副本集","children":[]}]}],"git":{"createdTime":1726027079000,"updatedTime":1726027079000,"contributors":[{"name":"ldf","email":"1305366530@qq.com","commits":1}]},"readingTime":{"minutes":4.82,"words":1445},"filePathRelative":"deploy/Linux部署文档/软件安装/Linux安装mongo主从模式.md","localizedDate":"2024年9月11日","autoDesc":true,"excerpt":"\\n<h2>一、知识沉淀：</h2>\\n<p><strong>Mongodb的replication主要有两种：主从和副本集（replica set）。现在mongodb官方建议用副本集替代主从复制。</strong></p>\\n<p><strong>什么是oplog：</strong></p>\\n<p>MongoDB 的Replication是通过一个日志来存储写操作的，这个日志就叫做oplog。 在默认情况下,oplog分配的是5%的空闲磁盘空间。通常而言,这是一种合理的设置。可以通过mongod --oplogSize来改变oplog的日志大小。</p>\\n<h4>主从复制：</h4>\\n<p>主从的原理和mysql类似，主节点记录在其上的所有操作oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。\\n 主服务器数据库的每次操作都会记录在其二进制文件mysql-bin.xxx（该文件可以在mysql目录下的data目录中看到）中，从服务器的I/O线程使用专用账号登录到主服务器中读取该二进制文件，并将文件内容写入到自己本地的中继日志relay-log文件中，然后从服务器的SQL线程会根据中继日志中的内容执行SQL语句</p>"}');export{h as comp,g as data};
