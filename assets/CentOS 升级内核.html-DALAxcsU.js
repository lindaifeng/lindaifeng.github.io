import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as n,f as i}from"./app-1glq8-TT.js";const a={},l=i(`<h1 id="centos-升级内核的三种方式-yum-rpm-源码" tabindex="-1"><a class="header-anchor" href="#centos-升级内核的三种方式-yum-rpm-源码"><span>CentOS 升级内核的三种方式(yum/rpm/源码)</span></a></h1><blockquote><p>在 CentOS 使用过程中，难免需要升级内核，但有时候因为源码编译依赖问题，不一定所有程序都支持最新内核版本，所以以下将介绍三种升级内核方式。</p></blockquote><h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>关于内核种类:</span></span>
<span class="line"><span>kernel-ml 中的ml是英文【 mainline stable 】的缩写，elrepo-kernel中罗列出来的是最新的稳定主线版本。</span></span>
<span class="line"><span>kernel-lt 中的lt是英文【 long term support 】的缩写，elrepo-kernel中罗列出来的长期支持版本。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># 检查内核版本</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">uname</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="一、yum安装" tabindex="-1"><a class="header-anchor" href="#一、yum安装"><span>一、yum安装</span></a></h2><h3 id="_1、导入仓库源" tabindex="-1"><a class="header-anchor" href="#_1、导入仓库源"><span>1、导入仓库源</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span></span>
<span class="line"><span></span></span>
<span class="line"><span>rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、查看可安装的软件包" tabindex="-1"><a class="header-anchor" href="#_2、查看可安装的软件包"><span>2、查看可安装的软件包</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>yum --enablerepo=&quot;elrepo-kernel&quot; list --showduplicates | sort -r | grep kernel-ml.x86_64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3、选择-ml-或-lt-版本安装" tabindex="-1"><a class="header-anchor" href="#_3、选择-ml-或-lt-版本安装"><span>3、选择 ML 或 LT 版本安装</span></a></h3><p>无指定版本默认安装最新</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 安装 ML 版本</span></span>
<span class="line"><span>yum --enablerepo=elrepo-kernel install  kernel-ml-devel kernel-ml -y   </span></span>
<span class="line"><span></span></span>
<span class="line"><span># 安装 LT 版本，K8S全部选这个</span></span>
<span class="line"><span>yum --enablerepo=elrepo-kernel install kernel-lt-devel kernel-lt -y</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、查看现有内核启动顺序" tabindex="-1"><a class="header-anchor" href="#_4、查看现有内核启动顺序"><span>4、查看现有内核启动顺序</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>awk -F\\&#39; &#39;$1==&quot;menuentry &quot; {print $2}&#39; /etc/grub2.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5、修改默认启动项" tabindex="-1"><a class="header-anchor" href="#_5、修改默认启动项"><span>5、修改默认启动项</span></a></h3><p>xxx 为序号数字，以指定启动列表中第x项为启动项，x从0开始计数</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>grub2-set-default xxxx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>例如设置以4.4内核启动</strong></p><p>则直接输入“grub2-set-default 0”，下次启动即可从4.4启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 查看内核启动序号</span></span>
<span class="line"><span>[root@localhost ~] awk -F\\&#39; &#39;$1==&quot;menuentry &quot; {print $2}&#39; /etc/grub2.cfg</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CentOS Linux (4.4.179-1.el7.elrepo.x86_64) 7 (Core)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CentOS Linux (3.10.0-693.el7.x86_64) 7 (Core)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CentOS Linux (0-rescue-6d4c599606814867814f1a8eec7bfd1e) 7 (Core)</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span># 设置启动序号</span></span>
<span class="line"><span>[root@localhost ~] grub2-set-default 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 重启</span></span>
<span class="line"><span>reboot</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 检查内核版本</span></span>
<span class="line"><span>uname -r</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="二、rpm安装" tabindex="-1"><a class="header-anchor" href="#二、rpm安装"><span>二、RPM安装</span></a></h2><p>检查内核版本</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>uname -r</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1、查找版本" tabindex="-1"><a class="header-anchor" href="#_1、查找版本"><span>1、查找版本</span></a></h3><p>因 ELRepo 源都是最新版本，所以旧版本内核只能手动下载。</p><p>查找 kernel rpm 历史版：</p><p>http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/</p><h3 id="_2、共需要下载三个类型-rpm" tabindex="-1"><a class="header-anchor" href="#_2、共需要下载三个类型-rpm"><span>2、共需要下载三个类型 rpm</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>wget http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-lt-devel-4.4.215-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"><span>wget http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-lt-headers-4.4.215-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"><span>wget http://mirrors.coreix.net/elrepo-archive-archive/kernel/el7/x86_64/RPMS/kernel-lt-4.4.215-1.el7.elrepo.x86_64.rpm</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、安装内核" tabindex="-1"><a class="header-anchor" href="#_3、安装内核"><span>3、安装内核</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>rpm -ivh kernel-lt-4.4.215-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"><span>rpm -ivh kernel-lt-devel-4.4.215-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"><span>或者</span></span>
<span class="line"><span>#一键安装所有</span></span>
<span class="line"><span>rpm -Uvh *.rpm</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、确认已安装内核版本" tabindex="-1"><a class="header-anchor" href="#_4、确认已安装内核版本"><span>4、确认已安装内核版本</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@localhost ~]# rpm -qa | grep kernel</span></span>
<span class="line"><span>kernel-headers-3.10.0-1160.15.2.el7.x86_64</span></span>
<span class="line"><span>kernel-devel-3.10.0-1160.49.1.el7.x86_64</span></span>
<span class="line"><span>kernel-tools-libs-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-ml-4.9.9-1.el7.elrepo.x86_64</span></span>
<span class="line"><span>kernel-lt-4.4.215-1.el7.elrepo.x86_64</span></span>
<span class="line"><span>kernel-tools-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-lt-devel-4.4.215-1.el7.elrepo.x86_64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5、设置启动" tabindex="-1"><a class="header-anchor" href="#_5、设置启动"><span>5、设置启动</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 查看启动顺序</span></span>
<span class="line"><span>[root@localhost ~]# awk -F\\&#39; &#39;$1==&quot;menuentry &quot; {print $2}&#39; /etc/grub2.cfg</span></span>
<span class="line"><span>CentOS Linux (4.4.215-1.el7.elrepo.x86_64) 7 (Core)</span></span>
<span class="line"><span>CentOS Linux (4.9.9-1.el7.elrepo.x86_64) 7 (Core)</span></span>
<span class="line"><span>CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span></span>
<span class="line"><span>CentOS Linux (0-rescue-b91f945269084aa98e8257311ee713c5) 7 (Core)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 设置启动顺序</span></span>
<span class="line"><span>[root@localhost ~]# grub2-set-default 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 重启生效</span></span>
<span class="line"><span>[root@localhost ~]# reboot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三、源码安装" tabindex="-1"><a class="header-anchor" href="#三、源码安装"><span>三、源码安装</span></a></h2><h3 id="_1、安装核心软件包" tabindex="-1"><a class="header-anchor" href="#_1、安装核心软件包"><span>1、安装核心软件包</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>yum install -y gcc make git ctags ncurses-devel openssl-devel</span></span>
<span class="line"><span>yum install -y bison flex elfutils-libelf-devel bc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、创建内核编译目录" tabindex="-1"><a class="header-anchor" href="#_2、创建内核编译目录"><span>2、创建内核编译目录</span></a></h3><p>使用 <code>home</code> 下的 <code>kernelbuild</code> 目录</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mkdir ~/kernelbuild</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3、获取内核源码" tabindex="-1"><a class="header-anchor" href="#_3、获取内核源码"><span>3、获取内核源码</span></a></h3><blockquote><p>清华大学镜像站：https://mirror.tuna.tsinghua.edu.cn/kernel/v4.x/?C=M&amp;O=D</p><p>其他源码安装包下载地址：https://mirrors.edge.kernel.org/pub/linux/kernel/</p><ul><li><code>linux-4.xx.xx.tar.xz</code></li><li><code>linux-4.xx.xx.tar.gz</code></li><li>这两个格式都可以的，tar.xz压缩率更高，文件更小。</li></ul></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>在线下载：wget https://mirror.tuna.tsinghua.edu.cn/kernel/v4.x/linux-4.17.11.tar.xz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4、解压内核代码" tabindex="-1"><a class="header-anchor" href="#_4、解压内核代码"><span>4、解压内核代码</span></a></h3><p>将其解压后进入源码目录:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>tar -xvJf linux-4.17.11.tar.xz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>为确保内核树绝对干净，进入内核目录并执行 make mrproper 命令:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cd linux-4.17.11</span></span>
<span class="line"><span>make clean &amp;&amp; make mrproper</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5、内核配置" tabindex="-1"><a class="header-anchor" href="#_5、内核配置"><span>5、内核配置</span></a></h3><p>复制当前的内核配置文件</p><p><code>config-3.10.0-862.el7.x86_64</code>是我当前环境的内核配置文件，根据实际情况修改</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cp /boot/config-3.10.0-862.el7.x86_64 .config</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><h4 id="高级配置" tabindex="-1"><a class="header-anchor" href="#高级配置"><span>高级配置</span></a></h4><p>y 是启用, n 是禁用, m 是需要时启用. <code>make menuconfig</code>: 老的 ncurses 界面，被 nconfig 取代 <code>make nconfig</code>: 新的命令行 ncurses 界面</p></blockquote><h3 id="_6、编译和安装" tabindex="-1"><a class="header-anchor" href="#_6、编译和安装"><span>6、编译和安装</span></a></h3><h4 id="编译内核" tabindex="-1"><a class="header-anchor" href="#编译内核"><span>编译内核</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>如果你是四核的机器，x可以是8</span></span>
<span class="line"><span>make -j x</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="安装内核" tabindex="-1"><a class="header-anchor" href="#安装内核"><span>安装内核</span></a></h4><p>编译完内核后安装:<strong>Warning: 从这里开始，需要 root 权限执行命令，否则会失败.</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>make modules_install install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_7、设置启动" tabindex="-1"><a class="header-anchor" href="#_7、设置启动"><span>7、设置启动</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># 查看启动顺序</span></span>
<span class="line"><span>[root@localhost ~]# awk -F\\&#39; &#39;$1==&quot;menuentry &quot; {print $2}&#39; /etc/grub2.cfg</span></span>
<span class="line"><span>CentOS Linux (4.17.11-1.el7.elrepo.x86_64) 7 (Core)</span></span>
<span class="line"><span>CentOS Linux (4.9.9-1.el7.elrepo.x86_64) 7 (Core)</span></span>
<span class="line"><span>CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span></span>
<span class="line"><span>CentOS Linux (0-rescue-b91f945269084aa98e8257311ee713c5) 7 (Core)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 设置启动顺序</span></span>
<span class="line"><span>[root@localhost ~]# grub2-set-default 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 重启生效</span></span>
<span class="line"><span>[root@localhost ~]# reboot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四、卸载-降级-内核" tabindex="-1"><a class="header-anchor" href="#四、卸载-降级-内核"><span>四、卸载 / 降级 内核</span></a></h2><blockquote><p>例如:</p><p>当系统已存在 LT 内核的 5.4.103 版本时，继续安装 LT 内核的 4.4.215 版本则会提示: <code>package kernel-lt-5.4.103-1.el7.elrepo.x86_64 (which is newer than kernel-lt-4.4.215-1.el7.elrepo.x86_64) is already installed</code></p><p>这时就需要进行内核降级，卸载最新版的内核。</p></blockquote><h3 id="_1、查看系统当前内核版本" tabindex="-1"><a class="header-anchor" href="#_1、查看系统当前内核版本"><span>1、查看系统当前内核版本</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@localhost ~]# uname -r</span></span>
<span class="line"><span>5.4.103-1.el7.elrepo.x86_64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、查看系统中全部内核" tabindex="-1"><a class="header-anchor" href="#_2、查看系统中全部内核"><span>2、查看系统中全部内核</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@localhost ~]# rpm -qa | grep kernel</span></span>
<span class="line"><span>kernel-headers-3.10.0-1160.15.2.el7.x86_64</span></span>
<span class="line"><span>kernel-devel-3.10.0-1160.49.1.el7.x86_64</span></span>
<span class="line"><span>kernel-tools-libs-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-ml-4.9.9-1.el7.elrepo.x86_64</span></span>
<span class="line"><span>kernel-lt-5.4.103-1.el7.elrepo.x86_64</span></span>
<span class="line"><span>kernel-tools-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-lt-devel-5.4.103-1.el7.elrepo.x86_64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、删除指定内核" tabindex="-1"><a class="header-anchor" href="#_3、删除指定内核"><span>3、删除指定内核</span></a></h3><p>此处以删除 LT 内核的 5.4.103 版本为例</p><p>**注意：**无法卸载当前在用的内核版本。卸载完后不一定需要重启</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>yum remove -y kernel-lt-devel-5.4.103-1.el7.elrepo.x86_64</span></span>
<span class="line"><span></span></span>
<span class="line"><span>yum remove -y kernel-lt-5.4.103-1.el7.elrepo.x86_64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查卸载后内核版本</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@localhost ~]# rpm -qa | grep kernel</span></span>
<span class="line"><span>kernel-headers-3.10.0-1160.15.2.el7.x86_64</span></span>
<span class="line"><span>kernel-devel-3.10.0-1160.49.1.el7.x86_64</span></span>
<span class="line"><span>kernel-tools-libs-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>kernel-ml-4.9.9-1.el7.elrepo.x86_64</span></span>
<span class="line"><span>kernel-tools-3.10.0-957.el7.x86_64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,75),r=[l];function d(t,p){return n(),s("div",null,r)}const o=e(a,[["render",d],["__file","CentOS 升级内核.html.vue"]]),u=JSON.parse('{"path":"/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/CentOS%20%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8.html","title":"CentOS 升级内核","lang":"zh-CN","frontmatter":{"title":"CentOS 升级内核","categories":["Linux"],"tags":["centos"],"order":1,"description":"CentOS 升级内核的三种方式(yum/rpm/源码) 在 CentOS 使用过程中，难免需要升级内核，但有时候因为源码编译依赖问题，不一定所有程序都支持最新内核版本，所以以下将介绍三种升级内核方式。 注意事项 一、yum安装 1、导入仓库源 2、查看可安装的软件包 3、选择 ML 或 LT 版本安装 无指定版本默认安装最新 4、查看现有内核启动顺序...","head":[["meta",{"property":"og:url","content":"http://blog.lindaifeng.vip/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/CentOS%20%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8.html"}],["meta",{"property":"og:site_name","content":"文档演示"}],["meta",{"property":"og:title","content":"CentOS 升级内核"}],["meta",{"property":"og:description","content":"CentOS 升级内核的三种方式(yum/rpm/源码) 在 CentOS 使用过程中，难免需要升级内核，但有时候因为源码编译依赖问题，不一定所有程序都支持最新内核版本，所以以下将介绍三种升级内核方式。 注意事项 一、yum安装 1、导入仓库源 2、查看可安装的软件包 3、选择 ML 或 LT 版本安装 无指定版本默认安装最新 4、查看现有内核启动顺序..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-11T03:57:59.000Z"}],["meta",{"property":"article:author","content":"清峰"}],["meta",{"property":"article:tag","content":"centos"}],["meta",{"property":"article:modified_time","content":"2024-09-11T03:57:59.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CentOS 升级内核\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-09-11T03:57:59.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"清峰\\",\\"url\\":\\"http://blog.lindaifeng.vip/\\"}]}"]]},"headers":[{"level":3,"title":"注意事项","slug":"注意事项","link":"#注意事项","children":[]},{"level":2,"title":"一、yum安装","slug":"一、yum安装","link":"#一、yum安装","children":[{"level":3,"title":"1、导入仓库源","slug":"_1、导入仓库源","link":"#_1、导入仓库源","children":[]},{"level":3,"title":"2、查看可安装的软件包","slug":"_2、查看可安装的软件包","link":"#_2、查看可安装的软件包","children":[]},{"level":3,"title":"3、选择 ML 或 LT 版本安装","slug":"_3、选择-ml-或-lt-版本安装","link":"#_3、选择-ml-或-lt-版本安装","children":[]},{"level":3,"title":"4、查看现有内核启动顺序","slug":"_4、查看现有内核启动顺序","link":"#_4、查看现有内核启动顺序","children":[]},{"level":3,"title":"5、修改默认启动项","slug":"_5、修改默认启动项","link":"#_5、修改默认启动项","children":[]}]},{"level":2,"title":"二、RPM安装","slug":"二、rpm安装","link":"#二、rpm安装","children":[{"level":3,"title":"1、查找版本","slug":"_1、查找版本","link":"#_1、查找版本","children":[]},{"level":3,"title":"2、共需要下载三个类型 rpm","slug":"_2、共需要下载三个类型-rpm","link":"#_2、共需要下载三个类型-rpm","children":[]},{"level":3,"title":"3、安装内核","slug":"_3、安装内核","link":"#_3、安装内核","children":[]},{"level":3,"title":"4、确认已安装内核版本","slug":"_4、确认已安装内核版本","link":"#_4、确认已安装内核版本","children":[]},{"level":3,"title":"5、设置启动","slug":"_5、设置启动","link":"#_5、设置启动","children":[]}]},{"level":2,"title":"三、源码安装","slug":"三、源码安装","link":"#三、源码安装","children":[{"level":3,"title":"1、安装核心软件包","slug":"_1、安装核心软件包","link":"#_1、安装核心软件包","children":[]},{"level":3,"title":"2、创建内核编译目录","slug":"_2、创建内核编译目录","link":"#_2、创建内核编译目录","children":[]},{"level":3,"title":"3、获取内核源码","slug":"_3、获取内核源码","link":"#_3、获取内核源码","children":[]},{"level":3,"title":"4、解压内核代码","slug":"_4、解压内核代码","link":"#_4、解压内核代码","children":[]},{"level":3,"title":"5、内核配置","slug":"_5、内核配置","link":"#_5、内核配置","children":[]},{"level":3,"title":"6、编译和安装","slug":"_6、编译和安装","link":"#_6、编译和安装","children":[]},{"level":3,"title":"7、设置启动","slug":"_7、设置启动","link":"#_7、设置启动","children":[]}]},{"level":2,"title":"四、卸载 / 降级 内核","slug":"四、卸载-降级-内核","link":"#四、卸载-降级-内核","children":[{"level":3,"title":"1、查看系统当前内核版本","slug":"_1、查看系统当前内核版本","link":"#_1、查看系统当前内核版本","children":[]},{"level":3,"title":"2、查看系统中全部内核","slug":"_2、查看系统中全部内核","link":"#_2、查看系统中全部内核","children":[]},{"level":3,"title":"3、删除指定内核","slug":"_3、删除指定内核","link":"#_3、删除指定内核","children":[]}]}],"git":{"createdTime":1726027079000,"updatedTime":1726027079000,"contributors":[{"name":"ldf","email":"1305366530@qq.com","commits":1}]},"readingTime":{"minutes":4.17,"words":1252},"filePathRelative":"deploy/Linux部署文档/操作系统/CentOS 升级内核.md","localizedDate":"2024年9月11日","autoDesc":true,"excerpt":"\\n<blockquote>\\n<p>在 CentOS 使用过程中，难免需要升级内核，但有时候因为源码编译依赖问题，不一定所有程序都支持最新内核版本，所以以下将介绍三种升级内核方式。</p>\\n</blockquote>\\n<h3>注意事项</h3>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>关于内核种类:</span></span>\\n<span class=\\"line\\"><span>kernel-ml 中的ml是英文【 mainline stable 】的缩写，elrepo-kernel中罗列出来的是最新的稳定主线版本。</span></span>\\n<span class=\\"line\\"><span>kernel-lt 中的lt是英文【 long term support 】的缩写，elrepo-kernel中罗列出来的长期支持版本。</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}');export{o as comp,u as data};
