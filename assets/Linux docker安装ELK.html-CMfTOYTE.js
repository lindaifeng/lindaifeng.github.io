import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,o as i,f as n}from"./app-B4WH2CHP.js";const e={},l=n(`<h1 id="linux-docker安装elk" tabindex="-1"><a class="header-anchor" href="#linux-docker安装elk"><span>Linux docker安装ELK</span></a></h1><p><strong>实现目标：</strong></p><p><strong>从kafka收集消息 --&gt; Logstash清洗消息 --&gt; Elastcsearch存储消息--&gt; Kibana展示消息全流程</strong></p><h2 id="一、安装elasticsearch" tabindex="-1"><a class="header-anchor" href="#一、安装elasticsearch"><span>一、安装ElasticSearch</span></a></h2><h3 id="elk简介" tabindex="-1"><a class="header-anchor" href="#elk简介"><span><strong>ELK简介</strong></span></a></h3><p>ELK主要由ElasticSearch、Logstash和Kibana三个开源工具组成，还有其他专门由于收集数据的轻量型数据采集器Beats</p><blockquote><p>Elasticsearch：分布式搜索引擎。具有高可伸缩、高可靠、易管理等特点。可以用于全文检索、结构化检索和分析，并能将这三者结合起来 Elasticsearch： 是用Java 基于 Lucene 开发，现在使用最广的开源搜索引擎之一，Wikipedia 、StackOverflow、Github等都基于它来构建自己的搜索引擎。在elasticsearch中，所有节点的数据是均等的。</p><p>Logstash ： 数据收集处理引擎。支持动态的从各种数据源搜集数据，并对数据进行过滤、分析、丰富、统一格式等操作，然后存储以供后续使用。</p><p>Kibana ： 可视化化平台。它能够搜索、展示存储在 Elasticsearch 中索引数据。使用它可以很方便的用图表、表格、地图展示和分析数据。</p><p>版本说明： Elasticsearch、Logstash、Kibana、Filebeat安装的版本号必须全部一致,不然会出现kibana无法显示web页面。</p></blockquote><blockquote><p>需要注意的是，如果操作系统版本不是很新不要安装最新版本docker，比如我centos7.2安装docker最新版，后面出现 linux 与 docker 版本的兼容性问题，报错”container init exited prematurely“，卸载docker安装较早版本即可。</p></blockquote><p>离线安装与在线基本相同（离线需要自行打包好镜像）</p><blockquote><p>离线思路： 1、在有网环境下下载镜像 2、通过docker save 打包好镜像，拷入u盘 3、将打包好的镜像上传至离线服务器 4、通过docker load 将打包好的镜像导入docker</p></blockquote><h3 id="_1、拉取镜像" tabindex="-1"><a class="header-anchor" href="#_1、拉取镜像"><span>1、拉取镜像</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker search elasticsearch</span></span>
<span class="line"><span>docker pull elasticsearch:7.7.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、创建挂载目录" tabindex="-1"><a class="header-anchor" href="#_2、创建挂载目录"><span>2、创建挂载目录</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mkdir -p /data/elk/es/{config,data,logs}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3、赋予权限" tabindex="-1"><a class="header-anchor" href="#_3、赋予权限"><span>3、赋予权限</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>chmod -R 777 /data/elk/es</span></span>
<span class="line"><span>chmod -R 777 /data/elk/es/config</span></span>
<span class="line"><span>chmod -R 777 /data/elk/es/data</span></span>
<span class="line"><span>chmod -R 777 /data/elk/es/logs</span></span>
<span class="line"><span>#报错挂载目录没权限</span></span>
<span class="line"><span>&quot;Caused by: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/data/nodes&quot;,</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、创建挂载es配置" tabindex="-1"><a class="header-anchor" href="#_4、创建挂载es配置"><span>4、创建挂载es配置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cd /data/elk/es/config</span></span>
<span class="line"><span>touch elasticsearch.yml</span></span>
<span class="line"><span>-----------------------配置内容----------------------------------</span></span>
<span class="line"><span>cluster.name: &quot;my-es&quot;</span></span>
<span class="line"><span>network.host: 0.0.0.0</span></span>
<span class="line"><span>http.port: 9200</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5、运行elasticsearch" tabindex="-1"><a class="header-anchor" href="#_5、运行elasticsearch"><span>5、运行elasticsearch</span></a></h3><blockquote><p>通过镜像，启动一个容器，并将9200和9300端口映射到本机（elasticsearch的默认端口是9200，我们把宿主环境9200端口映射到Docker容器中的9200端口）。此处建议给容器设置固定ip，我这里没设置。</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker run -it  -d -p 9200:9200 -p 9300:9300 --name es -e ES_JAVA_OPTS=&quot;-Xms1g -Xmx1g&quot; -e &quot;discovery.type=single-node&quot; --restart=always -v /data/elk/es/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /data/elk/es/data:/usr/share/elasticsearch/data -v /data/elk/es/logs:/usr/share/elasticsearch/logs elasticsearch:7.7.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6、验证安装是否成功" tabindex="-1"><a class="header-anchor" href="#_6、验证安装是否成功"><span>6、验证安装是否成功</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@elasticsearch home]# curl http://localhost:9200</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;name&quot; : &quot;0adf1765ac08&quot;,</span></span>
<span class="line"><span>  &quot;cluster_name&quot; : &quot;my-es&quot;,</span></span>
<span class="line"><span>  &quot;cluster_uuid&quot; : &quot;MpKqrEKySnSdwux0m7AlEA&quot;,</span></span>
<span class="line"><span>  &quot;version&quot; : {</span></span>
<span class="line"><span>    &quot;number&quot; : &quot;7.7.1&quot;,</span></span>
<span class="line"><span>    &quot;build_flavor&quot; : &quot;default&quot;,</span></span>
<span class="line"><span>    &quot;build_type&quot; : &quot;docker&quot;,</span></span>
<span class="line"><span>    &quot;build_hash&quot; : &quot;ad56dce891c901a492bb1ee393f12dfff473a423&quot;,</span></span>
<span class="line"><span>    &quot;build_date&quot; : &quot;2020-05-28T16:30:01.040088Z&quot;,</span></span>
<span class="line"><span>    &quot;build_snapshot&quot; : false,</span></span>
<span class="line"><span>    &quot;lucene_version&quot; : &quot;8.5.1&quot;,</span></span>
<span class="line"><span>    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span></span>
<span class="line"><span>    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>查看索引</span></span>
<span class="line"><span>GET /_cat/indices?v</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://so.csdn.net/so/search?q=elasticsearch&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">elasticsearch</a>启动时遇到的错误</p><p>es最大虚拟内存至少262144</p><p>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>1、vim /etc/sysctl.conf (需要是root账户)</span></span>
<span class="line"><span>文件最后添加一行: vm.max_map_count=262144</span></span>
<span class="line"><span>2、sysctl -p 重启生效</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="二、安装kibana" tabindex="-1"><a class="header-anchor" href="#二、安装kibana"><span>二、<strong>安装Kibana</strong></span></a></h2><h3 id="_1、下载镜像" tabindex="-1"><a class="header-anchor" href="#_1、下载镜像"><span>1、下载镜像</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker pull kibana:7.7.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2、获取elasticsearch容器ip" tabindex="-1"><a class="header-anchor" href="#_2、获取elasticsearch容器ip"><span>2、获取elasticsearch容器ip</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@elasticsearch home]# docker inspect --format &#39;{{ .NetworkSettings.IPAddress }}&#39; es</span></span>
<span class="line"><span>172.17.0.2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、新建配置文件" tabindex="-1"><a class="header-anchor" href="#_3、新建配置文件"><span>3、新建配置文件</span></a></h3><p>用于docker文件映射。所使用目录需对应新增。（172.17.0.2改成自己的）</p><p>vi /data/elk/kibana/kibana.yml</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#Default Kibana configuration for docker target</span></span>
<span class="line"><span>server.name: kibana</span></span>
<span class="line"><span>server.host: &quot;0&quot;</span></span>
<span class="line"><span>i18n.locale: &quot;zh-CN&quot;</span></span>
<span class="line"><span>elasticsearch.hosts: [&quot;http://172.17.0.2:9200&quot;]</span></span>
<span class="line"><span>xpack.monitoring.ui.container.elasticsearch.enabled: true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、运行kibana" tabindex="-1"><a class="header-anchor" href="#_4、运行kibana"><span>4、运行kibana</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker run -d --restart=always --log-driver json-file --log-opt max-size=100m --log-opt max-file=2 --name kibana -p 5601:5601 -v /data/elk/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.7.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5、访问" tabindex="-1"><a class="header-anchor" href="#_5、访问"><span>5、访问</span></a></h3><p>浏览器上输入：http://ip:5601，如无法访问进容器检查配置是否生效</p><h3 id="_6、检查kibana容器配置文件" tabindex="-1"><a class="header-anchor" href="#_6、检查kibana容器配置文件"><span>6、检查kibana容器配置文件</span></a></h3><p>将配置文件中elasticsearch.hosts地址修改为elasticsearch容器地址。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -it kibana /bin/bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>vi config/kibana.yml，修改后的配置如下： （（172.17.0.2改成自己的））</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#Default Kibana configuration for docker target</span></span>
<span class="line"><span>server.name: kibana</span></span>
<span class="line"><span>server.host: &quot;0&quot;</span></span>
<span class="line"><span>elasticsearch.hosts: [&quot;http://172.17.0.2:9200&quot;]</span></span>
<span class="line"><span>xpack.monitoring.ui.container.elasticsearch.enabled: true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启kibana：docker restart kibana</p><blockquote><p>在kibana6.7之后就开始支持中文了，开启也很简单，只需要在kibana.yml配置文件中添加上如下配置，然后重启kibana即可</p><p>i18n.locale: &quot;zh-CN&quot;</p></blockquote><h2 id="三、安装logstash" tabindex="-1"><a class="header-anchor" href="#三、安装logstash"><span>三、安装<strong>Logstash</strong></span></a></h2><h3 id="_1、获取logstash镜像" tabindex="-1"><a class="header-anchor" href="#_1、获取logstash镜像"><span>1、获取logstash镜像</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker pull logstash:7.7.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2、编辑logstash-yml配置文件" tabindex="-1"><a class="header-anchor" href="#_2、编辑logstash-yml配置文件"><span>2、编辑logstash.yml配置文件</span></a></h3><p>vi /data/elk/logstash/logstash.yml （es-docker内网地址） （172.17.0.2改成自己的）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>http.host: &quot;0.0.0.0&quot;</span></span>
<span class="line"><span>xpack.monitoring.elasticsearch.hosts: [ &quot;http://172.17.0.2:9200&quot; ]</span></span>
<span class="line"><span>xpack.monitoring.elasticsearch.username: elastic</span></span>
<span class="line"><span>xpack.monitoring.elasticsearch.password: changeme</span></span>
<span class="line"><span>#path.config: /data/elk/logstash/conf.d/*.conf</span></span>
<span class="line"><span>path.config: /data/docker/logstash/conf.d/*.conf</span></span>
<span class="line"><span>path.logs: /var/log/logstash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、编辑logstash-conf文件" tabindex="-1"><a class="header-anchor" href="#_3、编辑logstash-conf文件"><span>3、编辑logstash.conf文件</span></a></h3><p>此处先配置logstash直接采集本地数据发送至es</p><p>vi /data/elk/logstash/conf.d/syslog.conf （外网地址） （192.168.200.94改成自己的）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>input {</span></span>
<span class="line"><span>  syslog {</span></span>
<span class="line"><span>    type =&gt; &quot;system-syslog&quot;</span></span>
<span class="line"><span>    port =&gt; 5044</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>  elasticsearch {</span></span>
<span class="line"><span>    hosts =&gt; [&quot;192.168.x.x:9200&quot;]  # 定义es服务器的ip</span></span>
<span class="line"><span>    index =&gt; &quot;system-syslog-%{+YYYY.MM}&quot; # 定义索引</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、配置修改后重启服务" tabindex="-1"><a class="header-anchor" href="#_4、配置修改后重启服务"><span>4、配置修改后重启服务</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>systemctl restart rsyslog</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5、运行logstash" tabindex="-1"><a class="header-anchor" href="#_5、运行logstash"><span>5、运行logstash</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker run -d --restart=always --log-driver json-file --log-opt max-size=100m --log-opt max-file=2 -p 5044:5044 -p 9600:9600 --name logstash -v /data/elk/logstash/logstash.yml:/usr/share/logstash/config/logstash.yml -v /data/elk/logstash/conf.d/:/data/docker/logstash/conf.d/ logstash:7.7.1</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker run -d --privileged=true -p 5044:5044 -p 9600:9600 --name logstash -v /data/elk/logstash/logstash.yml:/usr/share/logstash/config/logstash.yml -v /data/elk/logstash/conf.d/:/data/docker/logstash/conf.d/ docker.elastic.co/logstash/logstash:7.13.0-arm64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6、测试es接收logstash数据" tabindex="-1"><a class="header-anchor" href="#_6、测试es接收logstash数据"><span>6、测试es接收logstash数据</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[root@elk logstash]# curl http://localhost:9200/_cat/indices?v</span></span>
<span class="line"><span>health status index                    uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span></span>
<span class="line"><span>green  open   .apm-custom-link         WBgbpphkQCS73sfjjIG0-Q   1   0          0            0       208b           208b</span></span>
<span class="line"><span>green  open   .kibana_task_manager_1   xmBASGi9QheR-r8hG2XLZA   1   0          5            0       28kb           28kb</span></span>
<span class="line"><span>green  open   .apm-agent-configuration MsvsgveHSCOhBQRCgTnsRg   1   0          0            0       208b           208b</span></span>
<span class="line"><span>yellow open   system-syslog-2022.02    1Vcjw7Q-TTqVscpknyK7HA   1   1          6            0     20.7kb         20.7kb</span></span>
<span class="line"><span>green  open   .kibana_1                vJ-B5wakRSmOrwM6ri-xgw   1   0         84            2      115kb          115kb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取到system-syslog-相关日志，则es已能获取来自logstash的数据，kibana中也同步显示数据。</p><h2 id="四、安装kafka" tabindex="-1"><a class="header-anchor" href="#四、安装kafka"><span>四、安装kafka</span></a></h2><blockquote><p>注意：</p><p>出现/docker-entrypoint.sh: line 43: /conf/zoo.cfg: Permission denied</p><p>一般都是目录没权限，给对应目录添加权限即可</p><p>chmod 777 xxx</p></blockquote><h3 id="_1、启动zookeeper容器" tabindex="-1"><a class="header-anchor" href="#_1、启动zookeeper容器"><span>1、启动zookeeper容器</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker run -d --name zookeeper -p 2181:2181 -t wurstmeister/zookeeper</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --privileged=true \\</span></span>
<span class="line"><span>--restart=always --name=zkNode-1 \\</span></span>
<span class="line"><span>-v /data/elk/zookeeper/conf:/conf \\</span></span>
<span class="line"><span>-v /data/elk/zookeeper/data:/data \\</span></span>
<span class="line"><span>-v /data/elk/zookeeper/datalog:/datalog zookeeper:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、启动kafka容器" tabindex="-1"><a class="header-anchor" href="#_2、启动kafka容器"><span>2、启动kafka容器</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#修改自己的zookeeper主机地址</span></span>
<span class="line"><span>docker run  -d --name kafka -p 9092:9092 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=192.168.x.x:2181 -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.x.x:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 -e ALLOW_PLAINTEXT_LISTENER=yes -t wurstmeister/kafka </span></span>
<span class="line"><span></span></span>
<span class="line"><span>#docker 启动参数说明: -d:后台启动,--restart=always:如果挂了总是会重启,--name:设置容器名</span></span>
<span class="line"><span>#-p: 设置宿主机与容器之间的端口映射,例如:9902:9092,表示将容器中9092端口映射到宿主机的9902端口,当有请求访问宿主机的9902端口时,会被转发到容器内部的9092端口.</span></span>
<span class="line"><span>#-v:设置宿主机与容器之间的路径或文件映射,例如:/home/kafka/logs:/opt/kafka/logs,表示将容器内部的路径/opt/kafka/logs目录映射到宿主机的/home/kafka/logs目录,可以方便的从宿主机/home/kafka/logs/就能访问到容器内的目录,一般数据文件夹,配置文件均可如此配置,便于管理和数据持久化</span></span>
<span class="line"><span>#-e 设置环境变量参数,例如-e KAFKA_BROKER_ID=1,表示将该环境变量设置到容器的环境变量中,容器在启动时会读取该环境变量,并替换掉容器中配置文件的对应默认配置(server.properties文件中的 broker.id=1)</span></span>
<span class="line"><span># kafka:latest 表示使用docker镜像名称为kafka,并且版本为latest的镜像来启动</span></span>
<span class="line"><span>docker run -d --restart=always --name kafka \\</span></span>
<span class="line"><span>-p 9092:9092 \\</span></span>
<span class="line"><span>-v /data/elk/kafka/logs:/opt/kafka/logs \\</span></span>
<span class="line"><span>-v /data/elk/kafka/data:/kafka/kafka-logs \\</span></span>
<span class="line"><span>-v /data/elk/kafka/conf:/opt/kafka/config \\</span></span>
<span class="line"><span>-e KAFKA_BROKER_ID=1 \\</span></span>
<span class="line"><span>-e KAFKA_LOG_DIRS=&quot;/kafka/kafka-logs&quot; \\</span></span>
<span class="line"><span>-e KAFKA_ZOOKEEPER_CONNECT=10.84.x.x:2181 \\</span></span>
<span class="line"><span>-e KAFKA_DEFAULT_REPLICATION_FACTOR=1 \\</span></span>
<span class="line"><span>-e KAFKA_LOG_RETENTION_HOURS=72 \\</span></span>
<span class="line"><span>-e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://10.84.x.x:9092 \\</span></span>
<span class="line"><span>-e ALLOW_PLAINTEXT_LISTENER=yes \\</span></span>
<span class="line"><span>-e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 -t kafka:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、测试kafka" tabindex="-1"><a class="header-anchor" href="#_3、测试kafka"><span>3、测试kafka</span></a></h3><p>进入kafka容器的命令行</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -ti kafka /bin/bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>进入kafka所在目录</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>cd opt/kafka_2.13-2.8.1/</span></span>
<span class="line"><span>#没有找到就用这个命令搜索</span></span>
<span class="line"><span>find / -name kafka-topics.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、创建topic" tabindex="-1"><a class="header-anchor" href="#_4、创建topic"><span>4、创建topic</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>./bin/kafka-topics.sh --create --bootstrap-server 10.84.x.x:2181 --partitions 1 --replication-factor 1 --topic cloud-log</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>./bin/kafka-topics.sh --create --bootstrap-server 127.0.0.1:9092 --partitions 1 --replication-factor 1 --topic cloud-log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5、查看topic-list" tabindex="-1"><a class="header-anchor" href="#_5、查看topic-list"><span>5、查看topic list</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bin/kafka-topics.sh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --zookeeper</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.84.x.x:2181</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./bin/kafka-topics.sh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --bootstrap-server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 127.0.0.1:9092</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --list</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6、发送消息" tabindex="-1"><a class="header-anchor" href="#_6、发送消息"><span>6、发送消息</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>./bin/kafka-console-producer.sh --broker-list 10.84.x.x:9092 --topic cloud-log</span></span>
<span class="line"><span></span></span>
<span class="line"><span>./kafka-console-producer.sh --broker-list 10.32.22.51:9092 --topic cloud-log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7、接收消息" tabindex="-1"><a class="header-anchor" href="#_7、接收消息"><span>7、接收消息</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>./bin/kafka-console-consumer.sh --bootstrap-server 10.84.x.x:9092 --topic cloud-log --from-beginning</span></span>
<span class="line"><span></span></span>
<span class="line"><span>./bin/kafka-console-consumer.sh --bootstrap-server 10.32.22.51:9092 --topic cloud-log --from-beginning</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于上面并未和kafka产生关联，所以修改logstash安装目录下的配置文件logstash/confg/conf.d/syslog.conf</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>input {</span></span>
<span class="line"><span>  #获取kafka信息</span></span>
<span class="line"><span>  kafka {</span></span>
<span class="line"><span>  		#自定义话题</span></span>
<span class="line"><span>        topics_pattern  =&gt; &quot;cloud-log&quot;</span></span>
<span class="line"><span>        #kafka ip+端口</span></span>
<span class="line"><span>        bootstrap_servers =&gt; &quot;10.84.x.x:9092&quot;</span></span>
<span class="line"><span>        auto_offset_reset =&gt; &quot;earliest&quot;</span></span>
<span class="line"><span>        consumer_threads =&gt; 5</span></span>
<span class="line"><span>        decorate_events =&gt; &quot;true&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>#文本格式过滤</span></span>
<span class="line"><span>filter {</span></span>
<span class="line"><span>    date {</span></span>
<span class="line"><span>      timezone =&gt; &quot;Asia/Shanghai&quot;</span></span>
<span class="line"><span>      match =&gt; [&quot;logtime&quot;, &quot;yyyy-MM-dd HH:mm:ss,SSS&quot;]</span></span>
<span class="line"><span>      target =&gt; &quot;@timestamp&quot;</span></span>
<span class="line"><span>      remove_field =&gt; [ &quot;logtime&quot; ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>  #输出至es</span></span>
<span class="line"><span>  elasticsearch {</span></span>
<span class="line"><span>    hosts =&gt; [&quot;http://10.84.x.x:9200&quot;]</span></span>
<span class="line"><span>    index =&gt; &quot;%{[@metadata][kafka][topic]}-%{+YYYY-MM-dd}&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  #本地生产文件日志(目录自行创建)</span></span>
<span class="line"><span>  file {</span></span>
<span class="line"><span>        path =&gt; &quot;/home/logs/%{+yyyy-MM-dd-HH}.log&quot;</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改完之后重新启动docker-elk，即完成从kafka收集消息 --&gt; Logstash清洗消息 --&gt; Elastcsearch存储消息--&gt; Kibana展示消息全流程。</strong></p><p>在arm运行时上述kafka方式运行正常但无法连接至es</p><p>以下采用docker-compose的方式部署</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3.2&#39;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  zookeeper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">zookeeper</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;2181:2181&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    privileged</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/data/elk/zookeeper/conf:/conf</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/data/elk/zookeeper/data:/data</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/data/elk/zookeeper/datalog:/datalog</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/localtime:/etc/localtime</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;zookeeper&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  kafka</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">wyh1791/kafka-arm64v8</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;kafka&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;9092:9092&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    privileged</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KAFKA_AUTO_CREATE_TOPICS_ENABLE=true</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KAFKA_ADVERTISED_HOST_NAME=10.32.22.52</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KAFKA_ADVERTISED_PORT=9092</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://10.32.22.52:9092</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KAFKA_LOG_RETENTION_HOURS=168</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/data/elk/kafka/data:/kafka</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/run/docker.sock:/var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/localtime:/etc/localtime</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,89),t=[l];function p(d,r){return i(),a("div",null,t)}const o=s(e,[["render",p],["__file","Linux docker安装ELK.html.vue"]]),k=JSON.parse('{"path":"/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Linux%20docker%E5%AE%89%E8%A3%85ELK.html","title":"Linux docker安装ELK","lang":"zh-CN","frontmatter":{"title":"Linux docker安装ELK","categories":["Docker"],"tags":["elk"],"order":3,"description":"Linux docker安装ELK 实现目标： 从kafka收集消息 --> Logstash清洗消息 --> Elastcsearch存储消息--> Kibana展示消息全流程 一、安装ElasticSearch ELK简介 ELK主要由ElasticSearch、Logstash和Kibana三个开源工具组成，还有其他专门由于收集数据的轻量型数据采...","head":[["meta",{"property":"og:url","content":"http://blog.lindaifeng.vip/deploy/Linux%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Linux%20docker%E5%AE%89%E8%A3%85ELK.html"}],["meta",{"property":"og:site_name","content":"文档演示"}],["meta",{"property":"og:title","content":"Linux docker安装ELK"}],["meta",{"property":"og:description","content":"Linux docker安装ELK 实现目标： 从kafka收集消息 --> Logstash清洗消息 --> Elastcsearch存储消息--> Kibana展示消息全流程 一、安装ElasticSearch ELK简介 ELK主要由ElasticSearch、Logstash和Kibana三个开源工具组成，还有其他专门由于收集数据的轻量型数据采..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-11T03:57:59.000Z"}],["meta",{"property":"article:author","content":"清峰"}],["meta",{"property":"article:tag","content":"elk"}],["meta",{"property":"article:modified_time","content":"2024-09-11T03:57:59.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux docker安装ELK\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-09-11T03:57:59.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"清峰\\",\\"url\\":\\"http://blog.lindaifeng.vip/\\"}]}"]]},"headers":[{"level":2,"title":"一、安装ElasticSearch","slug":"一、安装elasticsearch","link":"#一、安装elasticsearch","children":[{"level":3,"title":"ELK简介","slug":"elk简介","link":"#elk简介","children":[]},{"level":3,"title":"1、拉取镜像","slug":"_1、拉取镜像","link":"#_1、拉取镜像","children":[]},{"level":3,"title":"2、创建挂载目录","slug":"_2、创建挂载目录","link":"#_2、创建挂载目录","children":[]},{"level":3,"title":"3、赋予权限","slug":"_3、赋予权限","link":"#_3、赋予权限","children":[]},{"level":3,"title":"4、创建挂载es配置","slug":"_4、创建挂载es配置","link":"#_4、创建挂载es配置","children":[]},{"level":3,"title":"5、运行elasticsearch","slug":"_5、运行elasticsearch","link":"#_5、运行elasticsearch","children":[]},{"level":3,"title":"6、验证安装是否成功","slug":"_6、验证安装是否成功","link":"#_6、验证安装是否成功","children":[]}]},{"level":2,"title":"二、安装Kibana","slug":"二、安装kibana","link":"#二、安装kibana","children":[{"level":3,"title":"1、下载镜像","slug":"_1、下载镜像","link":"#_1、下载镜像","children":[]},{"level":3,"title":"2、获取elasticsearch容器ip","slug":"_2、获取elasticsearch容器ip","link":"#_2、获取elasticsearch容器ip","children":[]},{"level":3,"title":"3、新建配置文件","slug":"_3、新建配置文件","link":"#_3、新建配置文件","children":[]},{"level":3,"title":"4、运行kibana","slug":"_4、运行kibana","link":"#_4、运行kibana","children":[]},{"level":3,"title":"5、访问","slug":"_5、访问","link":"#_5、访问","children":[]},{"level":3,"title":"6、检查kibana容器配置文件","slug":"_6、检查kibana容器配置文件","link":"#_6、检查kibana容器配置文件","children":[]}]},{"level":2,"title":"三、安装Logstash","slug":"三、安装logstash","link":"#三、安装logstash","children":[{"level":3,"title":"1、获取logstash镜像","slug":"_1、获取logstash镜像","link":"#_1、获取logstash镜像","children":[]},{"level":3,"title":"2、编辑logstash.yml配置文件","slug":"_2、编辑logstash-yml配置文件","link":"#_2、编辑logstash-yml配置文件","children":[]},{"level":3,"title":"3、编辑logstash.conf文件","slug":"_3、编辑logstash-conf文件","link":"#_3、编辑logstash-conf文件","children":[]},{"level":3,"title":"4、配置修改后重启服务","slug":"_4、配置修改后重启服务","link":"#_4、配置修改后重启服务","children":[]},{"level":3,"title":"5、运行logstash","slug":"_5、运行logstash","link":"#_5、运行logstash","children":[]},{"level":3,"title":"6、测试es接收logstash数据","slug":"_6、测试es接收logstash数据","link":"#_6、测试es接收logstash数据","children":[]}]},{"level":2,"title":"四、安装kafka","slug":"四、安装kafka","link":"#四、安装kafka","children":[{"level":3,"title":"1、启动zookeeper容器","slug":"_1、启动zookeeper容器","link":"#_1、启动zookeeper容器","children":[]},{"level":3,"title":"2、启动kafka容器","slug":"_2、启动kafka容器","link":"#_2、启动kafka容器","children":[]},{"level":3,"title":"3、测试kafka","slug":"_3、测试kafka","link":"#_3、测试kafka","children":[]},{"level":3,"title":"4、创建topic","slug":"_4、创建topic","link":"#_4、创建topic","children":[]},{"level":3,"title":"5、查看topic list","slug":"_5、查看topic-list","link":"#_5、查看topic-list","children":[]},{"level":3,"title":"6、发送消息","slug":"_6、发送消息","link":"#_6、发送消息","children":[]},{"level":3,"title":"7、接收消息","slug":"_7、接收消息","link":"#_7、接收消息","children":[]}]}],"git":{"createdTime":1726027079000,"updatedTime":1726027079000,"contributors":[{"name":"ldf","email":"1305366530@qq.com","commits":1}]},"readingTime":{"minutes":7.43,"words":2230},"filePathRelative":"deploy/Linux部署文档/软件安装/Linux docker安装ELK.md","localizedDate":"2024年9月11日","autoDesc":true,"excerpt":"\\n<p><strong>实现目标：</strong></p>\\n<p><strong>从kafka收集消息 --&gt; Logstash清洗消息 --&gt; Elastcsearch存储消息--&gt; Kibana展示消息全流程</strong></p>\\n<h2>一、安装ElasticSearch</h2>\\n<h3><strong>ELK简介</strong></h3>\\n<p>ELK主要由ElasticSearch、Logstash和Kibana三个开源工具组成，还有其他专门由于收集数据的轻量型数据采集器Beats</p>\\n<blockquote>\\n<p>Elasticsearch：分布式搜索引擎。具有高可伸缩、高可靠、易管理等特点。可以用于全文检索、结构化检索和分析，并能将这三者结合起来\\nElasticsearch：\\n是用Java 基于 Lucene 开发，现在使用最广的开源搜索引擎之一，Wikipedia 、StackOverflow、Github等都基于它来构建自己的搜索引擎。在elasticsearch中，所有节点的数据是均等的。</p>\\n<p>Logstash ：\\n数据收集处理引擎。支持动态的从各种数据源搜集数据，并对数据进行过滤、分析、丰富、统一格式等操作，然后存储以供后续使用。</p>\\n<p>Kibana ：\\n可视化化平台。它能够搜索、展示存储在 Elasticsearch\\n中索引数据。使用它可以很方便的用图表、表格、地图展示和分析数据。</p>\\n<p>版本说明：\\nElasticsearch、Logstash、Kibana、Filebeat安装的版本号必须全部一致,不然会出现kibana无法显示web页面。</p>\\n</blockquote>"}');export{o as comp,k as data};
